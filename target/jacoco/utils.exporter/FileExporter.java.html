<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileExporter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ES-2023-2Sem-Sexta-Feira-LIGE-GrupoA</a> &gt; <a href="index.source.html" class="el_package">utils.exporter</a> &gt; <span class="el_source">FileExporter.java</span></div><h1>FileExporter.java</h1><pre class="source lang-java linenums">package utils.exporter;

import com.google.gson.GsonBuilder;
import com.opencsv.CSVWriter;
import com.opencsv.ICSVWriter;
import io.github.cdimascio.dotenv.Dotenv;
import models.*;
import com.google.gson.Gson;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.swing.*;
import java.io.IOException;
import java.io.StringWriter;
import java.text.SimpleDateFormat;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;


import static org.apache.logging.log4j.core.util.FileUtils.getFileExtension;

/**
 *  Classe que transforma um horário num ficheio CSV ou JSON, guardando-o
 */
public class FileExporter {
    
<span class="nc" id="L30">    private static final Logger logger = LoggerFactory.getLogger(FileExporter.class);</span>
<span class="nc" id="L31">    private static Dotenv dotenv = Dotenv.load();</span>
<span class="nc" id="L32">    private static String githubAccessToken = dotenv.get(&quot;GITHUB_ACCESS_TOKEN&quot;);</span>

<span class="nc" id="L34">    private FileExporter() {</span>
<span class="nc" id="L35">        throw new IllegalStateException(&quot;Classe de funções de utilidade!&quot;);</span>
    }

    /**
     * Convert a Horario object to a String in CSV or JSON format
     *
     * @param horario the Horario object to be converted
     * @throws IllegalArgumentException if the specified format is not supported
     */
    public static String convertHorarioToFormat(Horario horario) {
        String content;
<span class="nc bnc" id="L46" title="All 2 branches missed.">        if (&quot;json&quot;.equalsIgnoreCase(getFileExtension(horario.getFile()))) {</span>
<span class="nc" id="L47">            content = horarioToCsv(horario);</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">        } else if (&quot;csv&quot;.equalsIgnoreCase(getFileExtension(horario.getFile()))) {</span>
<span class="nc" id="L49">            content = horarioToJson(horario);</span>
        } else {
<span class="nc" id="L51">            throw new IllegalArgumentException(&quot;Formato não suportado: &quot; + getFileExtension(horario.getFile()));</span>
        }
<span class="nc" id="L53">        return content;</span>
    }

    /**
     * Exporta um arquivo para um Gist do GitHub.
     *
     * @param fileName  O nome do arquivo a ser enviado para o Gist.
     * @param content   O conteúdo do arquivo a ser enviado para o Gist.
     * @return O URL do Gist criado.
     * @throws IOException Se ocorrer um erro durante o processo de exportação para o Gist.
     */
    public static String exportToGist(String fileName, String content) throws IOException{
<span class="nc" id="L65">        logger.info(&quot;Starting upload to GIST...&quot;);</span>
        // check if the access token is set
<span class="nc bnc" id="L67" title="All 2 branches missed.">        if (githubAccessToken == null) {</span>
<span class="nc" id="L68">            JOptionPane.showMessageDialog(null, &quot;Não foi configurado o access token do GitHub!&quot;,</span>
                    &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L70">            throw new IllegalArgumentException(&quot;GITHUB_ACCESS_TOKEN environment variable not set&quot;);</span>
        }
<span class="nc" id="L72">        return GistExporter.uploadToGist(fileName, content, githubAccessToken);</span>
    }

    /**
     * Convert a Horario object to a String in CSV format
     *
     * @param horario the Horario object to be converted
     * @return the CSV data as a String
     */
    public static String horarioToCsv(Horario horario) {
<span class="nc" id="L82">        StringWriter stringWriter = new StringWriter();</span>
<span class="nc" id="L83">        try (CSVWriter writer = new CSVWriter(stringWriter, ';',</span>
                ICSVWriter.NO_QUOTE_CHARACTER,
                ICSVWriter.DEFAULT_ESCAPE_CHARACTER,
                ICSVWriter.DEFAULT_LINE_END)) {

<span class="nc" id="L88">            logger.info(&quot;Writing CSV file...&quot;);</span>

            // adding header to csv
<span class="nc" id="L91">            String[] header = { &quot;Curso&quot; ,&quot;Unidade Curricular&quot;,&quot;Turno&quot;,&quot;Turma&quot;,&quot;Inscritos no turno&quot;,&quot;Dia da semana&quot;,</span>
                    &quot;Hora início da aula&quot;,&quot;Hora fim da aula&quot;,&quot;Data da aula&quot;,&quot;Sala atribuída à aula&quot;,&quot;Lotação da sala&quot;};
<span class="nc" id="L93">            writer.writeNext(header);</span>

            // add data to csv
<span class="nc bnc" id="L96" title="All 2 branches missed.">            for (UnidadeCurricular uc : horario.getUnidadesCurriculares()) {</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">                for (Aula aula : uc.getAulas()) {</span>
<span class="nc" id="L98">                    SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</span>
<span class="nc" id="L99">                    String dateString = outputFormat.format(aula.getDataAula().getData());</span>
<span class="nc" id="L100">                    DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);</span>
<span class="nc" id="L101">                    String horaInicio = aula.getDataAula().getHoraInicio().format(timeFormatter);</span>
<span class="nc" id="L102">                    String horaFim = aula.getDataAula().getHoraFim().format(timeFormatter);</span>

<span class="nc" id="L104">                    String[] row = { uc.getCurso() , uc.getNomeUC(), aula.getTurno(), aula.getTurma() , aula.getNumInscritos().toString(),</span>
<span class="nc" id="L105">                            aula.getDataAula().getDiaSemana().getName(), horaInicio, horaFim, dateString, aula.getSala(), aula.getLotacao().toString()} ;</span>
<span class="nc" id="L106">                    writer.writeNext(row);</span>
<span class="nc" id="L107">                }</span>
<span class="nc" id="L108">            }</span>
<span class="nc" id="L109">            logger.info(&quot;CSV file written successfully.&quot;);</span>
        }
<span class="nc" id="L111">        catch (IOException e) {</span>
<span class="nc" id="L112">            logger.error(&quot;Error writing CSV file: {}&quot;, e.getMessage());</span>
<span class="nc" id="L113">        }</span>
<span class="nc" id="L114">        return stringWriter.toString();</span>
    }


    /**
     * Convert a Horario object to a String in JSON format
     *
     * @param horario the Horario object to be converted
     * @param outputFile the FileWriter object to write the converted Horario object

    public static void horarioToCsv(Horario horario, FileWriter outputFile) {

        try {

            // create CSVWriter object filewriter object as parameter
            CSVWriter writer = new CSVWriter(outputFile, ',',
                    ICSVWriter.NO_QUOTE_CHARACTER,
                    ICSVWriter.DEFAULT_ESCAPE_CHARACTER,
                    ICSVWriter.DEFAULT_LINE_END);

            LOGGER.info(&quot;Writing CSV file...&quot;);

            // adding header to csv
            String[] header = { &quot;Curso&quot; ,&quot;Unidade Curricular&quot;,&quot;Turno&quot;,&quot;Turma&quot;,&quot;Inscritos no turno&quot;,&quot;Dia da semana&quot;,&quot;Hora inÃ\u00ADcio da aula&quot;,&quot;Hora fim da aula&quot;,&quot;Data da aula&quot;,&quot;Sala atribuÃ\u00ADda Ã  aula&quot;,&quot;LotaÃ§Ã£o da sala&quot;};
            writer.writeNext(header);

            // add data to csv
            for (UnidadeCurricular uc : horario.getUnidadesCurriculares()) {
                for (Aula aula : uc.getAulas()) {
                    SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);
                    String dateString = outputFormat.format(aula.getDataAula().getData());
                    DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);
                    String horaInicio = aula.getDataAula().getHoraInicio().format(timeFormatter);
                    String horaFim = aula.getDataAula().getHoraFim().format(timeFormatter);

                    String[] row = { uc.getCurso() , uc.getNomeUC(), aula.getTurno(), aula.getTurma() , aula.getNumInscritos().toString(),
                            aula.getDataAula().getDiaSemana().getName(), horaInicio, horaFim, dateString, aula.getSala(), aula.getLotacao().toString()} ;
                    writer.writeNext(row);
                }
            }
            // closing writer connection
            writer.close();
            LOGGER.info(&quot;CSV file written successfully.&quot;);
        }
        catch (IOException e) {
            LOGGER.severe(&quot;Error writing CSV file: &quot; + e.getMessage());
            e.printStackTrace();

        }
    }*/

    /**
     * Converte um objeto do tipo Horario para uma representação em formato JSON.
     *
     * @param horario O objeto Horario a ser convertido em JSON.
     * @return A representação JSON do objeto Horario.
     */
    public static String horarioToJson(Horario horario) {

<span class="nc" id="L173">        String[] header = { &quot;Curso&quot; ,&quot;Unidade Curricular&quot;,&quot;Turno&quot;,&quot;Turma&quot;,&quot;Inscritos no turno&quot;,&quot;Dia da semana&quot;,</span>
                &quot;Hora início da aula&quot;,&quot;Hora fim da aula&quot;,&quot;Data da aula&quot;,&quot;Sala atribuída à aula&quot;,&quot;Lotação da sala&quot;};
<span class="nc" id="L175">        List&lt;Map&lt;String, Object&gt;&gt; jsonData = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">        for (UnidadeCurricular uc : horario.getUnidadesCurriculares()) {</span>

<span class="nc bnc" id="L178" title="All 2 branches missed.">            for (Aula aula : uc.getAulas()) {</span>

<span class="nc" id="L180">                SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</span>
<span class="nc" id="L181">                String dateString = outputFormat.format(aula.getDataAula().getData());</span>
<span class="nc" id="L182">                DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);</span>
<span class="nc" id="L183">                String horaInicio = aula.getDataAula().getHoraInicio().format(timeFormatter);</span>
<span class="nc" id="L184">                String horaFim = aula.getDataAula().getHoraFim().format(timeFormatter);</span>

<span class="nc" id="L186">                String[] row = {uc.getCurso(), uc.getNomeUC(), aula.getTurno(), aula.getTurma(), aula.getNumInscritos().toString(),</span>
<span class="nc" id="L187">                        aula.getDataAula().getDiaSemana().getName(), horaInicio, horaFim, dateString, aula.getSala(), aula.getLotacao().toString()};</span>

<span class="nc" id="L189">                Map&lt;String, Object&gt; jsonRow = createJsonDoc(header, row);</span>
<span class="nc" id="L190">                jsonData.add(jsonRow);</span>

<span class="nc" id="L192">            }</span>
<span class="nc" id="L193">        }</span>
<span class="nc" id="L194">        logger.info(&quot;Writing JSON file...&quot;);</span>

<span class="nc" id="L196">        Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L197">        String json = gson.toJson(jsonData);</span>
<span class="nc" id="L198">        logger.info(&quot;Created JSON String&quot;);</span>
<span class="nc" id="L199">        return json;</span>
    }

    /**
     * Cria um documento JSON a partir dos headers e valores de uma linha de dados.
     *
     * @param headers Array de strings com os cabeçalhos das colunas.
     * @param row Array de strings com os valores da linha de dados.
     * @return Um mapa contendo o documento JSON com os cabeçalhos como chaves e os valores como valores.
     */
    private static Map&lt;String, Object&gt; createJsonDoc(String[] headers, String[] row) {
<span class="nc" id="L210">        Map&lt;String, Object&gt; jsonDoc = new LinkedHashMap&lt;&gt;();</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">        for (int j = 0; j &lt; row.length; j++) {</span>
            try {
                // Procurar por valores do tipo integer
<span class="nc" id="L214">                int intValue = Integer.parseInt(row[j]);</span>
<span class="nc" id="L215">                jsonDoc.put(headers[j], intValue);</span>
<span class="nc" id="L216">            } catch (NumberFormatException e) {</span>
                // Se não encontrar valores do tipo integer, regista como string
<span class="nc" id="L218">                jsonDoc.put(headers[j], row[j]);</span>
<span class="nc" id="L219">            }</span>
        }
<span class="nc" id="L221">        return jsonDoc;</span>
    }
}




</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>