


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > FileUploader</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">utils.uploader</a>
</div>

<h1>Coverage Summary for Class: FileUploader (utils.uploader)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FileUploader</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/68)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package utils.uploader;
&nbsp;
&nbsp;import com.google.gson.GsonBuilder;
&nbsp;import com.opencsv.CSVWriter;
&nbsp;import com.opencsv.ICSVWriter;
&nbsp;import io.github.cdimascio.dotenv.Dotenv;
&nbsp;import models.*;
&nbsp;import com.google.gson.Gson;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;import javax.swing.*;
&nbsp;import java.io.IOException;
&nbsp;import java.io.StringWriter;
&nbsp;import java.text.SimpleDateFormat;
&nbsp;import java.time.format.DateTimeFormatter;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.LinkedHashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;
&nbsp;import static org.apache.logging.log4j.core.util.FileUtils.getFileExtension;
&nbsp;
&nbsp;public class FileUploader {
&nbsp;    
<b class="nc">&nbsp;    private static final Logger logger = LoggerFactory.getLogger(FileUploader.class);</b>
<b class="nc">&nbsp;    private static Dotenv dotenv = Dotenv.load();</b>
<b class="nc">&nbsp;    private static String githubAccessToken = dotenv.get(&quot;GITHUB_ACCESS_TOKEN&quot;);</b>
&nbsp;
<b class="nc">&nbsp;    private FileUploader() {</b>
<b class="nc">&nbsp;        throw new IllegalStateException(&quot;Classe de funções de utilidade!&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Convert a Horario object to a String in CSV or JSON format
&nbsp;     *
&nbsp;     * @param horario the Horario object to be converted
&nbsp;     * @throws IllegalArgumentException if the specified format is not supported
&nbsp;     */
&nbsp;    public static String convertHorarioToFormat(Horario horario) {
&nbsp;        String content;
<b class="nc">&nbsp;        if (&quot;json&quot;.equalsIgnoreCase(getFileExtension(horario.getFile()))) {</b>
<b class="nc">&nbsp;            content = horarioToCsv(horario);</b>
<b class="nc">&nbsp;        } else if (&quot;csv&quot;.equalsIgnoreCase(getFileExtension(horario.getFile()))) {</b>
<b class="nc">&nbsp;            content = horarioToJson(horario);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;Formato não suportado: &quot; + getFileExtension(horario.getFile()));</b>
&nbsp;        }
<b class="nc">&nbsp;        return content;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Exporta um arquivo para um Gist do GitHub.
&nbsp;     *
&nbsp;     * @param fileName  O nome do arquivo a ser enviado para o Gist.
&nbsp;     * @param content   O conteúdo do arquivo a ser enviado para o Gist.
&nbsp;     * @return O URL do Gist criado.
&nbsp;     * @throws IOException Se ocorrer um erro durante o processo de exportação para o Gist.
&nbsp;     */
&nbsp;    public static String exportToGist(String fileName, String content) throws IOException{
<b class="nc">&nbsp;        logger.info(&quot;Starting upload to GIST...&quot;);</b>
&nbsp;        // check if the access token is set
<b class="nc">&nbsp;        if (githubAccessToken == null) {</b>
<b class="nc">&nbsp;            JOptionPane.showMessageDialog(null, &quot;Não foi configurado o access token do GitHub!&quot;,</b>
&nbsp;                    &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;GITHUB_ACCESS_TOKEN environment variable not set&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return GistUploader.uploadToGist(fileName, content, githubAccessToken);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Convert a Horario object to a String in CSV format
&nbsp;     *
&nbsp;     * @param horario the Horario object to be converted
&nbsp;     * @return the CSV data as a String
&nbsp;     */
&nbsp;    public static String horarioToCsv(Horario horario) {
<b class="nc">&nbsp;        StringWriter stringWriter = new StringWriter();</b>
<b class="nc">&nbsp;        try (CSVWriter writer = new CSVWriter(stringWriter, &#39;;&#39;,</b>
&nbsp;                ICSVWriter.NO_QUOTE_CHARACTER,
&nbsp;                ICSVWriter.DEFAULT_ESCAPE_CHARACTER,
&nbsp;                ICSVWriter.DEFAULT_LINE_END)) {
&nbsp;
<b class="nc">&nbsp;            logger.info(&quot;Writing CSV file...&quot;);</b>
&nbsp;
&nbsp;            // adding header to csv
<b class="nc">&nbsp;            String[] header = { &quot;Curso&quot; ,&quot;Unidade Curricular&quot;,&quot;Turno&quot;,&quot;Turma&quot;,&quot;Inscritos no turno&quot;,&quot;Dia da semana&quot;,</b>
&nbsp;                    &quot;Hora início da aula&quot;,&quot;Hora fim da aula&quot;,&quot;Data da aula&quot;,&quot;Sala atribuída à aula&quot;,&quot;Lotação da sala&quot;};
<b class="nc">&nbsp;            writer.writeNext(header);</b>
&nbsp;
&nbsp;            // add data to csv
<b class="nc">&nbsp;            for (UnidadeCurricular uc : horario.getUnidadesCurriculares()) {</b>
<b class="nc">&nbsp;                for (Aula aula : uc.getAulas()) {</b>
<b class="nc">&nbsp;                    SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</b>
<b class="nc">&nbsp;                    String dateString = outputFormat.format(aula.getDataAula().getData());</b>
<b class="nc">&nbsp;                    DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);</b>
<b class="nc">&nbsp;                    String horaInicio = aula.getDataAula().getHoraInicio().format(timeFormatter);</b>
<b class="nc">&nbsp;                    String horaFim = aula.getDataAula().getHoraFim().format(timeFormatter);</b>
&nbsp;
<b class="nc">&nbsp;                    String[] row = { uc.getCurso() , uc.getNomeUC(), aula.getTurno(), aula.getTurma() , aula.getNumInscritos().toString(),</b>
<b class="nc">&nbsp;                            aula.getDataAula().getDiaSemana().getName(), horaInicio, horaFim, dateString, aula.getSala(), aula.getLotacao().toString()} ;</b>
<b class="nc">&nbsp;                    writer.writeNext(row);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            logger.info(&quot;CSV file written successfully.&quot;);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        catch (IOException e) {</b>
<b class="nc">&nbsp;            logger.error(&quot;Error writing CSV file: {}&quot;, e.getMessage());</b>
<b class="nc">&nbsp;            e.printStackTrace();</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return stringWriter.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Convert a Horario object to a String in JSON format
&nbsp;     *
&nbsp;     * @param horario the Horario object to be converted
&nbsp;     * @param outputFile the FileWriter object to write the converted Horario object
&nbsp;
&nbsp;    public static void horarioToCsv(Horario horario, FileWriter outputFile) {
&nbsp;
&nbsp;        try {
&nbsp;
&nbsp;            // create CSVWriter object filewriter object as parameter
&nbsp;            CSVWriter writer = new CSVWriter(outputFile, &#39;,&#39;,
&nbsp;                    ICSVWriter.NO_QUOTE_CHARACTER,
&nbsp;                    ICSVWriter.DEFAULT_ESCAPE_CHARACTER,
&nbsp;                    ICSVWriter.DEFAULT_LINE_END);
&nbsp;
&nbsp;            LOGGER.info(&quot;Writing CSV file...&quot;);
&nbsp;
&nbsp;            // adding header to csv
&nbsp;            String[] header = { &quot;Curso&quot; ,&quot;Unidade Curricular&quot;,&quot;Turno&quot;,&quot;Turma&quot;,&quot;Inscritos no turno&quot;,&quot;Dia da semana&quot;,&quot;Hora inÃ\u00ADcio da aula&quot;,&quot;Hora fim da aula&quot;,&quot;Data da aula&quot;,&quot;Sala atribuÃ\u00ADda Ã  aula&quot;,&quot;LotaÃ§Ã£o da sala&quot;};
&nbsp;            writer.writeNext(header);
&nbsp;
&nbsp;            // add data to csv
&nbsp;            for (UnidadeCurricular uc : horario.getUnidadesCurriculares()) {
&nbsp;                for (Aula aula : uc.getAulas()) {
&nbsp;                    SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);
&nbsp;                    String dateString = outputFormat.format(aula.getDataAula().getData());
&nbsp;                    DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);
&nbsp;                    String horaInicio = aula.getDataAula().getHoraInicio().format(timeFormatter);
&nbsp;                    String horaFim = aula.getDataAula().getHoraFim().format(timeFormatter);
&nbsp;
&nbsp;                    String[] row = { uc.getCurso() , uc.getNomeUC(), aula.getTurno(), aula.getTurma() , aula.getNumInscritos().toString(),
&nbsp;                            aula.getDataAula().getDiaSemana().getName(), horaInicio, horaFim, dateString, aula.getSala(), aula.getLotacao().toString()} ;
&nbsp;                    writer.writeNext(row);
&nbsp;                }
&nbsp;            }
&nbsp;            // closing writer connection
&nbsp;            writer.close();
&nbsp;            LOGGER.info(&quot;CSV file written successfully.&quot;);
&nbsp;        }
&nbsp;        catch (IOException e) {
&nbsp;            LOGGER.severe(&quot;Error writing CSV file: &quot; + e.getMessage());
&nbsp;            e.printStackTrace();
&nbsp;
&nbsp;        }
&nbsp;    }*/
&nbsp;
&nbsp;    /**
&nbsp;     * Converte um objeto do tipo Horario para uma representação em formato JSON.
&nbsp;     *
&nbsp;     * @param horario O objeto Horario a ser convertido em JSON.
&nbsp;     * @return A representação JSON do objeto Horario.
&nbsp;     */
&nbsp;    public static String horarioToJson(Horario horario) {
&nbsp;
<b class="nc">&nbsp;        String[] header = { &quot;Curso&quot; ,&quot;Unidade Curricular&quot;,&quot;Turno&quot;,&quot;Turma&quot;,&quot;Inscritos no turno&quot;,&quot;Dia da semana&quot;,</b>
&nbsp;                &quot;Hora início da aula&quot;,&quot;Hora fim da aula&quot;,&quot;Data da aula&quot;,&quot;Sala atribuída à aula&quot;,&quot;Lotação da sala&quot;};
<b class="nc">&nbsp;        List&lt;Map&lt;String, Object&gt;&gt; jsonData = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (UnidadeCurricular uc : horario.getUnidadesCurriculares()) {</b>
&nbsp;
<b class="nc">&nbsp;            for (Aula aula : uc.getAulas()) {</b>
&nbsp;
<b class="nc">&nbsp;                SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</b>
<b class="nc">&nbsp;                String dateString = outputFormat.format(aula.getDataAula().getData());</b>
<b class="nc">&nbsp;                DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);</b>
<b class="nc">&nbsp;                String horaInicio = aula.getDataAula().getHoraInicio().format(timeFormatter);</b>
<b class="nc">&nbsp;                String horaFim = aula.getDataAula().getHoraFim().format(timeFormatter);</b>
&nbsp;
<b class="nc">&nbsp;                String[] row = {uc.getCurso(), uc.getNomeUC(), aula.getTurno(), aula.getTurma(), aula.getNumInscritos().toString(),</b>
<b class="nc">&nbsp;                        aula.getDataAula().getDiaSemana().getName(), horaInicio, horaFim, dateString, aula.getSala(), aula.getLotacao().toString()};</b>
&nbsp;
<b class="nc">&nbsp;                Map&lt;String, Object&gt; jsonRow = createJsonDoc(header, row);</b>
<b class="nc">&nbsp;                jsonData.add(jsonRow);</b>
&nbsp;
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        logger.info(&quot;Writing JSON file...&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        Gson gson = new GsonBuilder().setPrettyPrinting().create();</b>
<b class="nc">&nbsp;        String json = gson.toJson(jsonData);</b>
<b class="nc">&nbsp;        logger.info(&quot;Created JSON String&quot;);</b>
<b class="nc">&nbsp;        return json;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Cria um documento JSON a partir dos headers e valores de uma linha de dados.
&nbsp;     *
&nbsp;     * @param headers Array de strings com os cabeçalhos das colunas.
&nbsp;     * @param row Array de strings com os valores da linha de dados.
&nbsp;     * @return Um mapa contendo o documento JSON com os cabeçalhos como chaves e os valores como valores.
&nbsp;     */
&nbsp;    private static Map&lt;String, Object&gt; createJsonDoc(String[] headers, String[] row) {
<b class="nc">&nbsp;        Map&lt;String, Object&gt; jsonDoc = new LinkedHashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        for (int j = 0; j &lt; row.length; j++) {</b>
&nbsp;            try {
&nbsp;                // Procurar por valores do tipo integer
<b class="nc">&nbsp;                int intValue = Integer.parseInt(row[j]);</b>
<b class="nc">&nbsp;                jsonDoc.put(headers[j], intValue);</b>
<b class="nc">&nbsp;            } catch (NumberFormatException e) {</b>
&nbsp;                // Se não encontrar valores do tipo integer, regista como string
<b class="nc">&nbsp;                jsonDoc.put(headers[j], row[j]);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return jsonDoc;</b>
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;
&nbsp;
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-04-21 10:41</div>
</div>
</body>
</html>
